DROP TABLE IF EXISTS "genres" CASCADE;
DROP TABLE IF EXISTS "films" CASCADE;
DROP TABLE IF EXISTS "film_genres" CASCADE;
DROP TABLE IF EXISTS "ratings" CASCADE;
DROP TABLE IF EXISTS "users" CASCADE;
DROP TABLE IF EXISTS "user_films_liked" CASCADE;
DROP TABLE IF EXISTS "user_friends" CASCADE;
DROP TABLE IF EXISTS "directors" CASCADE;
DROP TABLE IF EXISTS "film_directors" CASCADE;

CREATE TABLE IF NOT EXISTS "genres"
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS "ratings"
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS "films"
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL,
    description TEXT,
    release_date date,
    duration INTEGER,
    rating_id INTEGER NOT NULL REFERENCES "ratings" (id)
);

CREATE TABLE IF NOT EXISTS "users"
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email TEXT NOT NULL,
    login TEXT NOT NULL,
    name TEXT,
    birthday DATE
);

CREATE TABLE IF NOT EXISTS "film_genres"
(
    film_id INTEGER NOT NULL REFERENCES "films" (id)
    ON DELETE CASCADE ON UPDATE CASCADE,
    genre_id INTEGER NOT NULL REFERENCES "genres" (id)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS "user_films_liked"
(
    user_id INTEGER NOT NULL REFERENCES "users" (id)
    ON DELETE CASCADE ON UPDATE CASCADE,
    film_id INTEGER NOT NULL REFERENCES "films" (id)
    ON DELETE CASCADE ON UPDATE CASCADE
);

CREATE TABLE IF NOT EXISTS "user_friends"
(
    user_id INTEGER NOT NULL REFERENCES "users" (id)
    ON DELETE CASCADE ON UPDATE CASCADE,
    friend_id INTEGER NOT NULL REFERENCES "users" (id)
    ON DELETE CASCADE ON UPDATE CASCADE,
    is_accept BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE TABLE IF NOT EXISTS "directors"
(
    id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name TEXT NOT NULL
);

CREATE TABLE IF NOT EXISTS "film_directors"
(
    film_id INTEGER NOT NULL REFERENCES "films" (id)
    ON DELETE CASCADE ON UPDATE CASCADE,
    director_id INTEGER NOT NULL REFERENCES "directors" (id)
    ON DELETE CASCADE ON UPDATE CASCADE
    );